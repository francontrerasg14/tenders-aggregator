name: PLACSP + CCAA (RSS) debug

on: { workflow_dispatch: {} }

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Show tree & config
        run: |
          ls -la
          echo "---- collectors ----"; ls -la collectors || true
          echo "---- config.yml ----"; cat config.yml || true
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - name: Install deps
        run: |
          python -m pip install -U pip
          pip install -r requirements.txt
      - name: Set date (ayer Madrid)
        id: dt
        run: echo "FECHA=$(date -u -d 'now+2 hour -1 day' +'%Y-%m-%d')" >> $GITHUB_OUTPUT
      - name: RSS only (prefijo CPV, follow_detail con diagn√≥stico)
        run: |
          python run_daily.py --date ${{ steps.dt.outputs.FECHA }} --cpv-mode prefix --cpv 0933 4526 4531 --no-placsp --out rss_${{ steps.dt.outputs.FECHA }}.csv
          wc -l rss_${{ steps.dt.outputs.FECHA }}.csv || true
          head -n 20 rss_${{ steps.dt.outputs.FECHA }}.csv || true
      - uses: actions/upload-artifact@v4
        with:
          name: debug-csvs
          path: rss_*.csv
